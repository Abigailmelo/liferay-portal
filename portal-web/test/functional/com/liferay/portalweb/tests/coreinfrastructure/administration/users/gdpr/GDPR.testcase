@component-name = "portal-user-management-and-portal-configuration"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Users and Organizations";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		JSONUser.addUser(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		JSONRole.assignRoleToUser(
			roleTitle = "Administrator",
			userEmailAddress = "userea@liferay.com");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn");
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			User.tearDownCP();

			BlogsEntry.tearDownCP();

			DMDocument.tearDownCP();

			MessageboardsThread.tearDownCP();

			WikiPage.tearDownCP();
		}
	}

	@priority = "4"
	test AnonymizeEntryFromApplication {
		property test.name.skip.portal.instance = "GDPR#AnonymizeEntryFromApplication";

		User.logoutPG();

		User.loginUserPG(
			password = "test",
			userEmailAddress = "userea@liferay.com");

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMDocument.addCP(
			dmDocumentDescription = "DM Document Description",
			dmDocumentFile = "Document_1.txt",
			dmDocumentTitle = "DM Document Title");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "test@liferay.com",
			userLoginFullName = "Test Test");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.deletePersonalDataCP(
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.deactivateUser(
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.deletePersonalSite(
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.reviewPersonalData(
			applications = "Documents and Media",
			itemsCount = "1",
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.anonymizeDataViaReviewData(application = "Documents and Media");

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMNavigator.gotoDocumentCP(dmDocumentTitle = "DM Document Title");

		DMDocument.expandInfo();

		AssertTextEquals.assertPartialText(
			key_dmDocumentUploader = "Anonymous Anonymous",
			locator1 = "DocumentsAndMediaDocument#DOCUMENT_DETAILS_UPLOADER",
			value1 = "Anonymous Anonymous");
	}

	@priority = "5"
	test DeleteEntryFromApplication {
		property portal.acceptance = "true";
		property test.name.skip.portal.instance = "GDPR#DeleteEntryFromApplication";

		User.logoutPG();

		User.loginUserPG(
			password = "test",
			userEmailAddress = "userea@liferay.com");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Blogs");

		Blogs.addEntry(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "test@liferay.com",
			userLoginFullName = "Test Test");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.deletePersonalDataCP(
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.deactivateUser(
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.deletePersonalSite(
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.reviewPersonalData(
			applications = "Blogs",
			itemsCount = "1",
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.deletePersonalApplicationsData(
			applications = "Blogs",
			rowEntry = "Blogs Entry Title");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Blogs");

		LexiconEntry.viewNoEntry(rowEntry = "Blogs Entry Title");
	}

	@priority = "4"
	test EditEntryFromApplication {
		property test.name.skip.portal.instance = "GDPR#EditEntryFromApplication";

		User.logoutPG();

		User.loginUserPG(
			password = "test",
			userEmailAddress = "userea@liferay.com");

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMDocument.addCP(
			dmDocumentDescription = "DM Document Description",
			dmDocumentFile = "Document_1.txt",
			dmDocumentTitle = "DM Document Title");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "test@liferay.com",
			userLoginFullName = "Test Test");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.deletePersonalDataCP(
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.deactivateUser(
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.deletePersonalSite(
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.reviewPersonalData(
			applications = "Documents and Media",
			itemsCount = "1",
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.editPersonalApplicationsData(
			applications = "Documents and Media",
			rowEntry = "DM Document Title");

		DMDocument.editCmd(
			dmDocumentDescriptionEdit = "Edit DM Document Description",
			dmDocumentTitleEdit = "Edit DM Document Title");

		Button.clickPublish();

		AssertElementPresent(
			key_firstName = "userfn",
			key_lastName = "userln",
			locator1 = "DataErasure#HEADER");

		GDPR.viewEntryRowInApplicationCP(
			tableEntry = "Edit DM Document Title",
			tableEntryPartialTextList = "Edit DM Document Title,Edit DM Document Description");
	}

	@priority = "4"
	test ExportAllEntries {
		property test.name.skip.portal.instance = "GDPR#ExportAllEntries";

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		ProductMenu.gotoPortlet(
			category = "Build",
			panel = "Site Administration",
			portlet = "Pages");

		SitePages.addPublicPage(pageName = "Announcements Page");

		SitePages.configurePage(
			columnName = "1 Column",
			pageName = "Announcements Page",
			privacy = "Public Pages",
			sitePageType = "Widget Page");

		Navigator.gotoPage(pageName = "Announcements Page");

		Portlet.addPG(portletName = "Announcements");

		AnnouncementsEntry.addPG(
			distributionScope = "General",
			entryContent = "Announcements Entry Content",
			entryTitle = "Announcements Entry Title",
			entryURL = "http://www.liferay.com");

		AnnouncementsEntry.viewPG(
			distributionScope = "General",
			entryContent = "Announcements Entry Content",
			entryTitle = "Announcements Entry Title");

		ProductMenu.gotoPortlet(
			category = "Build",
			panel = "Site Administration",
			portlet = "Pages");

		SitePages.addPublicPage(pageName = "Contacts Center Page");

		SitePages.configurePage(
			columnName = "1 Column",
			pageName = "Contacts Center Page",
			privacy = "Public Pages",
			sitePageType = "Widget Page");

		Navigator.gotoPage(pageName = "Contacts Center Page");

		Portlet.addPG(portletName = "Contacts Center");

		ContactsCenter.addPG(
			contactName = "test1",
			emailAddress = "test1@liferay.com");

		ContactsCenter.viewContactPG(
			contactName = "test1",
			emailAddress = "test1@liferay.com");

		Navigator.openURL();

		BlogsNavigator.openBlogsAdmin(siteURLKey = "guest");

		Blogs.addEntry(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title");

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMDocument.addCP(
			dmDocumentDescription = "DM Document Description",
			dmDocumentFile = "Document_1.txt",
			dmDocumentTitle = "DM Document Title");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Message Boards");

		MessageboardsThread.addCP(
			threadBody = "MB Thread Message Body",
			threadSubject = "MB Thread Message Subject");

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Wiki");

		WikiNavigator.gotoNode(wikiNodeName = "Main");

		WikiNavigator.gotoAllPagesCP();

		WikiPage.addCP(
			wikiPageContent = "Wiki Page Content",
			wikiPageTitle = "Wiki Page Title");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "test@liferay.com",
			userLoginFullName = "Test Test");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.exportPersonalDataCP(
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.addExportProcessCP(
			userFirstName = "userfn",
			userLastName = "userln");

		GDPR.downloadExportedPersonalData(applications = "Message Boards");

		AssertConsoleTextNotPresent(value1 = "java.lang.NullPointerException");
	}

}